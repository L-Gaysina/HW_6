---
title: "HW_6"
author: "Gaisina Liana"
date: "2024-04-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Homework № 6. Расчет выборки при планировании исследования.

```{r}
# Библиотеки
library(pwr)
```

> Напишите соответствующий код, пользуясь указанными формулами.
>
> Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.
>
> **Task 1.** Что нужно сделать: (3 балла) Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% ( = 0.20), а разница средних составляет −10% (). Клиницисты сообщают нам, что клинически значимая разница составляет 25% ( = 0.25).

```{r}
# Задаем значения
alpha <- 0.05 # Уровень значимости
beta <- 0.2  # Значение beta
sigma_m <- 0.2 # Дисперсия
delta <- 0.25 # Разница средних
e <- 0.1 # Клинически значимая разница
dropout_rate <- 0.1 # Drop-out rate

# Считаем значения Z values для alpha и beta
z_alpha_2 <- qnorm(1 - alpha / 2)
z_beta <- qnorm(1 - beta)

# Расчет размера одной выборки по формуле
n <- ((z_alpha_2 + z_beta)^2 * sigma_m^2) / (2*(delta - e)^2)

# Учитываем drop-out rate
n <- n / (1 - dropout_rate)

# Округляем в большую сторону
n <- ceiling(n)

# Считаем общий размер выборки
total_n <- n * 2

# Вывод результатов
cat(' Размер выборки (n1=n2):', n)
cat('\n','Общий размер выборки для двухпериодного cross-over дизайна (n):', total_n)

```

> **Task 2.** (3 балла) Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет = 0.85. Соотношение групп равно = 1.

```{r}
# Задание исходных значений
alpha <- 0.05  # Уровень значимости
beta <- 0.20   # Мощность исследования
p1 <- 0.85     # Пропорция ответов для тестового препарата
p2 <- 0.65     # Пропорция ответов для препарата сравнения
delta <- -0.1  # Клинически значимая разница
ratio <- 1     # Соотношение размеров групп

# Вычисление Z-значений
z_alpha_2 <- qnorm(1 - alpha / 2)
z_beta <- qnorm(1 - beta)

# Расчет размера выборки для каждой группы
n <- ((z_alpha_2 + z_beta)^2 * (p1 * (1 - p1) + p2 *(1 - p2))) / ((p1 - p2 - delta)^2)

# Учитываем drop-out rate
n <- n / (1 - dropout_rate)

# Округляем в большую сторону
n <- ceiling(n)

# Расчет общего размера выборки с учетом соотношения групп
n_total <- n * (1 + ratio)

# Вывод результатов
cat(' Размер выборки (n1=n2):', n)
cat('\n','Общий размер выборки для двухпериодного cross-over дизайна (n):', n_total)

```

> **Task 3.** (4 балла) Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов ( = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны ().

```{r}

# Исходные данные для расчета
alpha <- 0.05 # Уровень значимости
beta <- 0.20  # Мощность исследования
HR <- 2       # Отношение рисков "золотой стандарт / новая терапия", hazard ratio
p1 <- 0.5     # Соотношение групп терапии
p2 <- 0.5     # Соотношение групп терапии
d <- 0.8      # Предполагаемая доля пациентов, которые могут столкнуться с заболеванием

# Вычисление критических значений Z для alpha и beta
z_alpha_2 <- qnorm(1 - alpha / 2)
z_beta <- qnorm(1 - beta)

# Расчет размера выборки для каждой группы, используя формулу из задания
n <- ((z_alpha_2 + z_beta)^2) / ((log(HR))^2 * p1 * p2 * d)


# Учитываем drop-out rate
n <- n / (1 - dropout_rate)

# Округляем в большую сторону
n <- ceiling(n)

# Расчет общего размера выборки
n_total <- n * 2

# Вывод результатов
cat(' Размер выборки (n1=n2):', n)
cat('\n','Общий размер выборки для двухпериодного cross-over дизайна (n):', n_total)
```
